!function r(n,i,a){function o(t,e){if(!i[t]){if(!n[t]){var s="function"==typeof require&&require;if(!e&&s)return s(t,!0);if(h)return h(t,!0);throw(s=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",s}s=i[t]={exports:{}},n[t][0].call(s.exports,function(e){return o(n[t][1][e]||e)},s,s.exports,r,n,i,a)}return i[t].exports}for(var h="function"==typeof require&&require,e=0;e<a.length;e++)o(a[e]);return o}({1:[function(e,t,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ObjectListener=s.StaticListener=s.Listener=void 0;s.Listener=class{constructor(){this._events={}}on(e,t){this._events[e]instanceof Array||(this._events[e]=[]),t instanceof Function&&this._events[e].push(t)}once(t,s){var r;this._events[t]instanceof Array||(this._events[t]=[]),s instanceof Function&&(r=(...e)=>{this.removeListener(t,r),s(...e)},this._events[t].push(r))}removeListener(e,t){this._events[e]instanceof Array||(this._events[e]=[]),t instanceof Function&&-1!=this._events[e].indexOf(t)&&(this._events[e]=i(this._events[e],this._events[e].indexOf(t)))}removeListeners(e){this._events[e]instanceof Array||(this._events[e]=[]);for(var t=0;t<this._events[e].length;t+=1)this.removeListener(e,this._events[e][t])}off(e,t=null){t instanceof Function?this.removeListener(e,t):this.removeListeners(e)}callEvent(s,...r){return new Promise((t,e)=>{this._events[s]instanceof Array||(this._events[s]=[]),0<this._events[s].length?this._events[s].forEach(e=>{setTimeout(()=>{t(e(...r))})}):t(void 0)})}};class r{static on(e,t){this._events[e]instanceof Array||(this._events[e]=[]),t instanceof Function&&this._events[e].push(t)}static once(t,s){var r;this._events[t]instanceof Array||(this._events[t]=[]),s instanceof Function&&(r=(...e)=>{this.removeListener(t,r),s(...e)},this._events[t].push(r))}static removeListener(e,t){this._events[e]instanceof Array||(this._events[e]=[]),t instanceof Function&&-1!=this._events[e].indexOf(t)&&(this._events[e]=i(this._events[e],this._events[e].indexOf(t)))}static removeListeners(e){this._events[e]instanceof Array||(this._events[e]=[]);for(var t=0;t<this._events[e].length;t+=1)this.removeListener(e,this._events[e][t])}static off(e,t=null){t instanceof Function?this.removeListener(e,t):this.removeListeners(e)}static callEvent(s,...r){return new Promise((t,e)=>{this._events[s]instanceof Array||(this._events[s]=[]),0<this._events[s].length?this._events[s].forEach(e=>{setTimeout(()=>{t(e(...r))})}):t(void 0)})}}(s.StaticListener=r)._events={};const n={_events:{},on(e,t){this._events[e]instanceof Array||(this._events[e]=[]),t instanceof Function&&this._events[e].push(t)},once(t,s){var r;this._events[t]instanceof Array||(this._events[t]=[]),s instanceof Function&&(r=(...e)=>{this.removeListener(t,r),s(...e)},this._events[t].push(r))},removeListener(e,t){this._events[e]instanceof Array||(this._events[e]=[]),t instanceof Function&&-1!=this._events[e].indexOf(t)&&(this._events[e]=i(this._events[e],this._events[e].indexOf(t)))},removeListeners(e){this._events[e]instanceof Array||(this._events[e]=[]);for(var t=0;t<this._events[e].length;t+=1)this.removeListener(e,this._events[e][t])},off(e,t=null){t instanceof Function?this.removeListener(e,t):this.removeListeners(e)},callEvent(s,...r){return new Promise((t,e)=>{this._events[s]instanceof Array||(this._events[s]=[]),0<this._events[s].length?this._events[s].forEach(e=>{setTimeout(()=>{t(e(...r))})}):t(void 0)})}};function i(e,t){for(var s=[],r=[],n=0;n<t;n+=1)s.push(e[n]);for(n=t+1;n<e.length;n+=1)s.push(e[n]);for(var i=[],n=0;n<s.length;n+=1)i.push(s[n]);for(n=0;n<r.length;n+=1)i.push(r[n]);return i}s.ObjectListener={get(){let t={};return Object.keys(n).forEach(e=>{t[e]=n[e]}),t},patch(s){return Object.keys(s).forEach(t=>{s[t]instanceof Function&&(s["_"+t]=s[t],s[t]=function(...e){return s["_"+t](...e)})}),s}}},{}],2:[function(e,t,s){"use strict";var r,n,i,a,o,h,c,f=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},l=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0});var u=e("../utils/listener.class");const v=e("./recorder");class d extends u.Listener{constructor(e,t){super(),r.set(this,null),n.set(this,null),i.set(this,null),a.set(this,null),o.set(this,!0),h.set(this,null),c.set(this,(e,t)=>{t=e instanceof Object&&!(e instanceof Array)?e:{event:e,content:t};l(this,i,"f")?.send(JSON.stringify(t))}),f(this,r,e,"f"),f(this,n,t,"f")}get url(){return l(this,r,"f")}get protocols(){return l(this,n,"f")}get websocket(){return l(this,i,"f")}get closed(){return l(this,o,"f")}get langModel(){return l(this,h,"f")}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeListeners(e){return super.removeListeners(e)}off(e,t){return super.off(e,t)}callEvent(e,...t){return super.callEvent(e,...t)}open(){return new Promise((e,t)=>{this.once("open",()=>e(!0)),f(this,i,new WebSocket(this.url||"",this.protocols||void 0),"f"),l(this,i,"f").addEventListener("open",()=>{l(this,i,"f")?.addEventListener("message",e=>{e=JSON.parse(e.data);this.callEvent(e.event,e.content)}),f(this,o,!1,"f"),this.callEvent("open")}),l(this,i,"f").addEventListener("error",(...e)=>{this.callEvent("error",...e)}),f(this,a,(new v.Recorder).record(),"f");let s=e=>{this.transcribe(e)};l(this,a,"f").on("data",s),l(this,i,"f").addEventListener("close",async()=>{l(this,a,"f")?.off("data",s),await l(this,a,"f")?.stop(),f(this,a,null,"f"),f(this,i,null,"f"),f(this,o,!0,"f"),this.callEvent("close")})})}close(){return new Promise((e,t)=>{this.once("close",()=>e(!0)),l(this,i,"f")?.close()})}getLangModels(){return new Promise((t,e)=>{var s={event:""+Date.now(),content:{command:"get_models"}};this.once(s.event,e=>{t(e.models)}),l(this,c,"f").call(this,s)})}setLangModel(r){return new Promise((t,e)=>{var s={event:""+Date.now(),content:{command:"set_model",model:r}};this.once(s.event,e=>{t(e.model)}),!l(this,o,"f")&&r&&l(this,c,"f").call(this,s)})}transcribe(e){l(this,i,"f")?.send(e)}async startRecording(){return await l(this,a,"f")?.start()}async stopRecording(){return await l(this,a,"f")?.stop()}}s.default=d,r=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,h=new WeakMap,c=new WeakMap;try{window&&(window.VoskStream={Client:d})}catch(e){}},{"../utils/listener.class":1,"./recorder":3}],3:[function(e,t,s){"use strict";var r,n,i,a,o,h,c,f,l,u,v,d=this&&this.__classPrivateFieldSet||function(e,t,s,r,n){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s},p=this&&this.__classPrivateFieldGet||function(e,t,s,r){if("a"===s&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)};Object.defineProperty(s,"__esModule",{value:!0}),s.Recorder=s.Record_=void 0;class w extends e("../utils/listener.class").Listener{constructor({type:e,recorder:t=null}){super(),r.set(this,void 0),n.set(this,null),i.set(this,null),a.set(this,void 0),o.set(this,null),h.set(this,null),c.set(this,new Array),f.set(this,!0),l.set(this,null),d(this,r,e,"f"),d(this,a,t,"f"),this.recorder?.records.add(this)}get type(){return p(this,r,"f")}get stream(){return p(this,n,"f")}get media_recorder(){return p(this,i,"f")}get recorder(){return p(this,a,"f")}get stopped(){return p(this,f,"f")}on(e,t){return super.on(e,t)}once(e,t){return super.once(e,t)}removeListener(e,t){return super.removeListener(e,t)}removeListeners(e){return super.removeListeners(e)}off(e,t){return super.off(e,t)}callEvent(e,...t){return super.callEvent(e,...t)}setStreamRate(e){clearInterval(p(this,l,"f")),d(this,l,setInterval(()=>{this.media_recorder?.requestData()},e),"f")}async start(){return d(this,f,!1,"f"),d(this,o,new Array,"f"),d(this,n,await navigator.mediaDevices.getUserMedia({video:!1,audio:{echoCancellation:!0,noiseSuppression:!0,channelCount:1,sampleRate:16e3}}),"f"),d(this,i,new MediaRecorder(p(this,n,"f")),"f"),!!this.media_recorder&&(this.media_recorder.addEventListener("dataavailable",async e=>{e.data&&0!=e.data.size&&(p(this,o,"f")?.push(e.data),this.callEvent("data",await e.data.arrayBuffer()))}),this.media_recorder.start(),this.setStreamRate(500),this.callEvent("start"),!0)}stop(){return new Promise((r,e)=>{this.media_recorder&&this.stream&&"inactive"!=this.media_recorder.state&&(this.media_recorder.addEventListener("stop",e=>{d(this,h,new Blob(p(this,o,"f"),{type:this.type}),"f"),p(this,c,"f").forEach(e=>{e()});var t=p(this,c,"f").length;for(let e=0;e<t;++e)p(this,c,"f").shift();let s=this.stream?.getTracks();s?.forEach(e=>{e.stop()}),clearInterval(p(this,l,"f")),d(this,f,!0,"f"),this.callEvent("stop"),r(!0)}),this.media_recorder.stop())})}async blob(){return new Promise((e,t)=>{p(this,h,"f")instanceof Blob?e(p(this,h,"f")):p(this,c,"f").push(()=>{p(this,h,"f")instanceof Blob&&e(p(this,h,"f"))})})}async base64(){var e=await this.blob();let t=new File([e],"record",{type:this.type});return function(e){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=new Uint8Array(e),n=r.byteLength,i=n%3,a=n-i,o,h,c,f,l;for(let e=0;e<a;e+=3)l=r[e]<<16|r[e+1]<<8|r[e+2],o=(16515072&l)>>18,h=(258048&l)>>12,c=(4032&l)>>6,f=63&l,t+=s[o]+s[h]+s[c]+s[f];1==i?(l=r[a],o=(252&l)>>2,h=(3&l)<<4,t+=s[o]+s[h]+"=="):2==i&&(l=r[a]<<8|r[1+a],o=(64512&l)>>10,h=(1008&l)>>4,c=(15&l)<<2,t+=s[o]+s[h]+s[c]+"=");return t}((await t.stream().getReader().read()).value)}async datauri(){return"data:"+this.type+";base64,"+await this.base64()}remove(){this.recorder?.records.remove(this)}}s.Record_=w,r=new WeakMap,n=new WeakMap,i=new WeakMap,a=new WeakMap,o=new WeakMap,h=new WeakMap,c=new WeakMap,f=new WeakMap,l=new WeakMap;class _{constructor(){u.set(this,new Array)}get(e){return p(this,u,"f")[e]}add(e){p(this,u,"f").includes(e)||p(this,u,"f").push(e)}remove(e){var r=e instanceof w?p(this,u,"f").indexOf(e):e;if(-1<r&&r<p(this,u,"f").length){let t=new Array,s=new Array;for(let e=0;e<r;++e)t.push(p(this,u,"f")[e]);for(let e=r+1;e<p(this,u,"f").length;++e)s.push(p(this,u,"f")[e]);d(this,u,t.concat(s),"f")}}all(){let t=new Array;for(let e=0;e<p(this,u,"f").length;++e)t.push(p(this,u,"f")[e]);return t}clear(){d(this,u,new Array,"f")}}u=new WeakMap;class m{constructor(){v.set(this,new _)}get records(){return p(this,v,"f")}record(e){return new w({type:e?.type||"audio/wav",recorder:this})}stop(){this.records.all().forEach(e=>{e.stop()})}clear(){this.stop(),this.records.clear()}}s.Recorder=m,v=new WeakMap,m.Record=w;try{window&&(window.Recorder=m)}catch(e){}},{"../utils/listener.class":1}]},{},[2]);